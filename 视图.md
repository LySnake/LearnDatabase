### 11. 视图

#### 11.1 视图的概念

**视图**:就是 `由数据库中的一张表或多张表根据特定的条件查询出的数据构造成的`虚拟表。

#### 11.2 视图的作用

* **安全性**:如果我们直接将数据表授权给用户操作，那么用户可以CRUD数据表中所有数据，加入我们想要对数据表中的部分数据进行保护，可以将公开的数据生成视图，授权用户访问视图;用户通过查询视图可以获取数据表中公开的数据，从而达到将数据表中的部分数据对用户隐藏。
* **简单性**：如果我们需要查询的数据来源于多张数据表，可以使用多表连接查询来实现；我们通过视图将这些连接表查询的结果对用户开放，用户则可以直接通过查询视图获取多表数据，操作更便捷。

#### 11.3 创建视图

##### 11.3.1 语法

```sql
create view <view-name>
AS 
select_statement;
```

##### 11.3.2 示例

* 示例1:

```sql
-- 创建视图实例1:将学生表中性别 为男的学生生成一个视图
create view view_test1
AS 
select * students where stu_gender = '男';

-- 查询视图
select * from view_test1;
```

* 示例2:
  ```sql
  -- 创建视图示例2:查询学生借书的信息(学生名、图书名、借书数量)
  create view view_test2
  AS 
  select s.stu_name, b.book_name, borrow_num from books b inner join records r inner join students s on b.book_id = r.bid and r.snum = s.stu_num;

  -- 查询视图
  select * view_test2;
  ```

#### 11.4 视图数据的特性

视图是虚拟表，查询视图的数据是来源于数据表的。当对视图进行操作时，对原数据表中的数据是否影响呢？

* 查询操作

  * 如果在数据表中添加了新的数据，而且这个数据满足创建视图时查询语句的条件，那么通过查询视图也可以查询出新增加的数据；当删除原表中满足查询条件中数据时，也会从视图中删除。
* 新增数据

  * 如果在视图中添加数据，且添加的数据映射到源数据表时，也能添加新的记录，那么数据会被添加到原数据表中，否则无法添加到源数据表中。
* 删除数据

  * 如果从视图删除数据，数据也将从原表中删除，但是在关联多表时，难以根据从视图中删除一条数据匹配到多个源数据表中的记录，因此大可能删除失败。
* 修改数据

  * 如果通过修改数据，则也将修改原数据表中的数据，但是在关联多张数据表时，修改了某一个字段的值，那么可能只是映射到对应的源数据表中的对应字段的值修改。

**视图使用建议**:对复杂查询简化操作，并且不会对数据进行修改的情况下可以使用视图。

#### 11.5 查询视图结构

```sql
-- 查询视图结构
desc <view-name>;
```

#### 11.6 修改视图

```sql
-- 方式1
create OR REPLACE view <view-name>
AS
select * from students where stu_gander = '男';

-- 方式2
alter view <view-name>
AS
select * from students where stu_gander = '女';
```

#### 11.7 删除视图

* 删除数据表时会同时删除数据表中的数据，删除视图时不会影响原数据表中的数据

```sql
-- 删除视图
drop view <view-name>;
```
