### 12. 索引

> 数据库是用来存储数据，在互联网应用中数据库中存储的数据可能会很多(大数据)，`数据表中数据的查询速度会随着数据量的增长逐渐变慢`，从而导致响应用户请求的速度变慢--用户体验差，我们如何提高数据库的查询效率呢？

#### 12.1 索引的介绍

索引，就是用来提高数据表中数据的查询效率的。

> 索引，就是将数据表中某一列/某几列的值取出来构造成便于查找的结构进行存储，生成数据表的 `目录索引`，当我们进行数据查询的时候，则先在 `目录索引`中进行查找得到对应的数据的地址，然后再到数据表中根据地址快速的获取数据记录，避免全表扫描。

#### 12.2 索引的分类

MySQL中的索引，根据创建索引的列的不同，可以分为:

* 主键索引:在数据表的主键字段创建的索引，这个字段必须被 `primary key`修饰，每张表只能有一个主键。
* 唯一索引:在数据表中的唯一列创建的索引(unique)，此列的所有值只能出现一次，可以为`NULL`。
* 普通索引:在普通字段上创建的索引，没有唯一性的限制
* 组合索引:两个及以上的字段联合起来创建的索引。

**说明**：

1. 在创建数据表时，将字段声明为主键(添加主键约束)，会自动在主键字段创建主键索引;
2. 在创建数据表时，将字段声明为唯一键(添加唯一约束)，会自动在唯一字段创建唯一索引；

#### 12.3 创建索引

##### 12.3.1 唯一索引

```sql
-- 创建唯一索引: 创建唯一索引的列的值不能重复
-- create unique index 索引名 on 表名(列名);
create unique index <index-name> on <table-name>(<feild-name>);
```

##### 12.3.2 普通索引

```sql
-- 创建普通索引
-- create index 索引名 on 表名(列名);
create index <index-name> on <table-name>(<feild-name>);
```

##### 12.3.3 组合索引

```sql
-- 创建组合索引
-- create index 索引名 on 表名(列名1, 列名2, ...);
create index <index-name> on <table-name>(<feild-name1>, <feild-name2>,...);
```

##### 12.3.4 全文索引

> MySQL5.6版本新增的索引，可以通过此索引进行全文检索操作，因为MySQL全文检索不支持中文，因此这个全文索引不被开发者关注，在应用开发中通常是通过搜索引擎(数据库中间件)实现全文检索。

```sql
-- create fulltext index 索引名 on 表名(字段名);
create fulltext index <index-name> on <talbe-name>(<feild-name>);
```

#### 12.4 索引使用

> 索引创建完成后无需调用，当根据创建索引的列进行数据查询的时候，会自动使用索引;
>
> 组合索引需要根据创建索引的所有字段进行查询的触发。

* 在命令行窗口中可以查看查询语句的查询规划,获取某条查询的详细信息，比如索引条数等:
  ```sql
  explain select * from tb_index where tid=20000\G;
  ```

#### 12.5 查看索引

```sql
-- 命令行
show create table tb_index\G;

-- 查询数据表的索引
show indexes from <table-name>;

-- 查询索引
show keys from <table-name>;
```

#### 12.6 删除索引

```sql
-- 删除索引:索引是建立在表的字段上的，不同的表中可能会出现相同名称的索引，因此删除索引时需要指定表名
drop index <index-name> on <table-name>;
```

#### 12.7 索引使用总结

##### 12.7.1 优点

* 索引大大降低了数据库服务器在执行查询操作时扫描的数据，提高查询效率；
* 索引可以避免服务器排序、将随机IO变成顺序IO

##### 12.7.2 缺点

* 索引是根据数据表列创建的，当数据表中数据发生DML操作时，索引页需要更新；
* 索引文件也会占用磁盘空间；

##### 12.7.3 注意事项

* 数据表中数据不多时，全表扫描可能更快，不要使用索引；
* 数据量大但是DML操作很频繁时，不建议使用索引；
* 不要在数据重复率高的列上创建索引(students表中的性别列)；
* 创建索引之后，要注意查询SQL语句的编写，避免索引失效；
